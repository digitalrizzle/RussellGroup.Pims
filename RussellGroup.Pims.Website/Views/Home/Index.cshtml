@{
    ViewBag.Title = "Home Page";
    ViewBag.HasBreadcrumb = false;
}

<div style="margin-top: 50px">
    <h2>Plant</h2>
    <div class="processing">
        Gathering data for the chart...
    </div>
    <div class="processed">
        <div id="pieChart"></div>
    </div>
</div>

@section scripts {
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
        // Check out the following for loading data through JSON
        // https://developers.google.com/chart/interactive/docs/php_example
        // http://blogs.microsoft.co.il/blogs/pini_dayan/archive/2009/03/12/convert-objects-to-json-in-c-using-javascriptserializer.aspx

        // Here is some more information about charts
        // https://google-developers.appspot.com/chart/interactive/docs/gallery/piechart

        $('.processed').hide();

        // Load the Visualization API and the chart package
        google.load('visualization', '1.0', { 'packages': ['corechart'] });

        // Set a callback to run when the Google Visualization API is loaded
        google.setOnLoadCallback(drawPieChart);

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it
        function drawPieChart() {
            var jsonText = $.ajax({
                url: '@Url.Content("~/Home/GetPlantData")',
                dataType: "json",
                nocache: true,
                async: false
            }).responseText;

            jsonData = $.parseJSON(jsonText);

            // Create the data table
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Status');
            data.addColumn('number', 'Value');

            //for (item in jsonData) {
            jsonData.map(function (item) {
                data.addRows([[item.key, item.value]]);
            });

            // Set chart options
            var options = {
                'is3D': true,
                'width': 900,
                'height': 300,
                'chartArea': { left:20, top:0, width:'100%', height:'100%' },
                'colors': ['#0ea31b', '#1e90ff', '#dc0000', '#ffd700', '#ff33cc', '#808080', '#000000'],
                'sliceVisibilityThreshold': 0,
                'tooltip': { text: 'percentage' }
            };

            // Instantiate and draw the chart, passing in some options
            var chart = new google.visualization.PieChart(document.getElementById('pieChart'));
            chart.draw(data, options);

            // Add a handler for when a part of the chart is selected
            google.visualization.events.addListener(chart, 'select', function (e) {
                var selection = chart.getSelection();

                var row = -1;

                for (var i = 0; i < selection.length; i++) {

                    var item = selection[i];

                    if (item.row != null && item.column != null) {
                        row = item.row;
                    } else if (item.row != null) {
                        row = item.row;
                    } else if (item.column != null) {
                        row = -1;
                    }
                }

                // Add one for the id since the rows are zero-based
                if (row >= 0) {
                    downloadReport(row + 1);
                }
            });

            $('.processing').hide();
            $('.processed').show();
        }
    </script>
}